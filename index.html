<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>An Quy Cháº¿ â€“ ÄÄƒng kÃ½ ca</title>

<link rel="manifest" href="manifest.json">

<style>
  body{
    margin:0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont;
    background:#020617;
    color:#e5e7eb;
  }
  header{
    background:#0ea5a4;
    padding:16px;
    text-align:center;
    font-weight:700;
    font-size:20px;
  }
  .container{
    padding:16px;
    max-width:520px;
    margin:auto;
  }
  .card{
    background:#020617;
    border:1px solid #0ea5a4;
    border-radius:12px;
    padding:14px;
    margin-bottom:14px;
  }
  table{
    width:100%;
    border-collapse:collapse;
  }
  td{
    padding:8px;
  }
  select,input,button{
    width:100%;
    padding:10px;
    border-radius:10px;
    border:none;
    font-size:16px;
  }
  select,input{
    background:#0f172a;
    color:white;
  }
  button{
    background:#0ea5a4;
    color:#020617;
    font-weight:700;
    margin-top:12px;
  }
  .ok{color:#22c55e}
</style>
</head>

<body>
<header>AN QUY CHáº¾ â€“ Há»† THá»NG ÄÄ‚NG KÃ CA</header>

<div class="container">

<div class="card">
  <h3>ğŸ“… ÄÄƒng kÃ½ ca trong tuáº§n</h3>
  <table>
    <tbody id="schedule"></tbody>
  </table>

  <input id="nameInput" placeholder="Nháº­p tÃªn (hoáº·c QuanLy)" />
  <button onclick="submitSchedule()">XÃ¡c nháº­n Ä‘Äƒng kÃ½</button>
  <div id="status"></div>
</div>

<div id="managerBox" class="card" style="display:none">
  <h3>ğŸ“Š Tá»•ng há»£p cho quáº£n lÃ½</h3>
  <div id="managerData">â³ Äang táº£i dá»¯ liá»‡u...</div>
</div>

</div>

<!-- FIREBASE (COMPAT â€“ á»”N Äá»ŠNH NHáº¤T) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ===== FIREBASE CONFIG (ÄÃƒ Sá»¬A CHUáº¨N) ===== */
const firebaseConfig = {
  apiKey: "AIzaSyCK6yfVr9VBMGwhbvYMXkJqMoRjo4Om2LM",
  authDomain: "an-quy.firebaseapp.com",
  databaseURL: "https://an-quy-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "an-quy",
  storageBucket: "an-quy.appspot.com",
  messagingSenderId: "672469940026",
  appId: "1:672469940026:web:a38e5b15bbeb2361b84203"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===== LOGIC APP ===== */
const days=["T2","T3","T4","T5","T6","T7","CN"];
const shifts=["","C1","F1","C2","F2","C3"];
const week=new Date().getFullYear()+"-W"+Math.ceil((((new Date()-new Date(new Date().getFullYear(),0,1))/86400000)+new Date(new Date().getFullYear(),0,1).getDay()+1)/7);

const tbody=document.getElementById("schedule");
days.forEach(d=>{
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td>${d}</td>
    <td>
      <select data-day="${d}">
        <option value="">â€” KhÃ´ng lÃ m â€”</option>
        ${shifts.filter(s=>s).map(s=>`<option>${s}</option>`).join("")}
      </select>
    </td>`;
  tbody.appendChild(tr);
});

function submitSchedule(){
  const name=nameInput.value.trim();
  if(!name){ alert("Nháº­p tÃªn"); return; }

  if(name.toLowerCase()==="quanly"){
    showManager();
    return;
  }

  const updates={};
  document.querySelectorAll("select").forEach(s=>{
    if(s.value){
      updates[`registrations/${week}/${s.dataset.day}/${s.value}/${name}`]=true;
    }
  });

  firebase.database().ref().update(updates).then(()=>{
    status.innerHTML="<p class='ok'>âœ… ÄÃ£ ghi nháº­n</p>";
  });
}

function showManager(){
  managerBox.style.display="block";
  db.ref("registrations/"+week).get().then(snap=>{
    if(!snap.exists()){ managerData.innerHTML="ChÆ°a cÃ³ dá»¯ liá»‡u"; return; }
    let html="";
    snap.forEach(day=>{
      day.forEach(shift=>{
        shift.forEach(name=>{
          html+=`<div>ğŸ‘¤ ${name.key}: ${day.key} - ${shift.key}</div>`;
        });
      });
    });
    managerData.innerHTML=html;
  });
}

/* SERVICE WORKER */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
